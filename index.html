<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>åœŸæ˜Ÿæ˜Ÿç¯å›å¿†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            cursor: crosshair;
            /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 2s ease-out;
        }

        #loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            color: #fff;
            font-size: 24px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .anniversary-fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        #canvas-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #photo-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #fff;
            border-radius: 20px;
            padding: 0;
            z-index: 100;
            transition: transform 0.35s ease-out;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #photo-modal.show {
            transform: translate(-50%, -50%) scale(1);
        }

        #photo-modal img {
            max-width: calc(90vw - 50px);
            max-height: calc(90vh - 50px);
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }


        .modal-title {
            color: #fff;
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
        }


        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #fff;
            border-radius: 10px;
            padding: 15px;
            color: #fff;
            font-size: 14px;
            z-index: 50;
            min-width: 220px;
            max-height: 80vh;
            display: block; /* ç¡®ä¿æ§åˆ¶é¢æ¿é»˜è®¤æ˜¾ç¤º */
        }

        .control-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-panel h3 {
            margin: 0;
            font-size: 16px;
            color: #ffd700;
        }

        .toggle-details-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            color: #ffd700;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .toggle-details-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: scale(1.1);
        }

        .detailed-controls {
            transition: all 0.3s ease;
            overflow-y: auto;
            max-height: calc(80vh - 80px); /* å‡å»æ ‡é¢˜åŒºåŸŸçš„é«˜åº¦ */
            opacity: 1;
            scrollbar-width: thin;
            scrollbar-color: #ffd700 #333;
        }

        .detailed-controls.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group .value {
            font-size: 12px;
            color: #ffd700;
            text-align: center;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        @media (max-width: 768px) {
            .loading-text {
                font-size: 18px;
            }
            
            #photo-modal {
                width: 90vw;
                height: 80vh;
                max-width: 90vw;
                max-height: 80vh;
                padding: 15px;
            }
            
            .modal-title {
                font-size: 16px;
            }
            
            
            .control-panel {
                top: 10px;
                right: 10px;
                padding: 10px;
                min-width: 180px;
                font-size: 12px;
                max-height: 80vh;
            }
            
            .control-panel h3 {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-text">
            <div id="love-counter">æ‹çˆ±ç¬¬ <span id="day-count">1</span> å¤©</div>
            <div id="anniversary-message" style="display: none; font-size: 20px; margin-top: 10px; color: #ffd700;"> ä¸€å‘¨å¹´å·²è¾¾æˆï¼Œè§£é”æ–°åœºæ™¯</div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <div id="photo-modal">
        <div class="modal-title" id="modal-title"></div>
        <img id="modal-image" src="" alt="å›å¿†ç…§ç‰‡">
    </div>

    <div class="control-panel">
        <div class="control-panel-header">
            <h3>ğŸŒŸ æ§åˆ¶é¢æ¿</h3>
            <button id="toggleDetails" class="toggle-details-btn">+</button>
        </div>
        <div id="detailed-controls" class="detailed-controls">
        <div class="control-group">
            <label>æ—‹è½¬é€Ÿåº¦ (åœˆ/åˆ†é’Ÿ)</label>
            <input type="range" id="rotationSpeed" min="0" max="2" step="0.1" value="0">
            <div class="value" id="rotationValue">0 åœˆ/åˆ†é’Ÿ</div>
        </div>
        <div class="control-group">
            <label>ç›¸æœºè·ç¦»</label>
            <input type="range" id="cameraDistance" min="8" max="30" step="0.5" value="13.5">
            <div class="value" id="cameraDistanceValue">13.5</div>
        </div>
        <div class="control-group">
            <label>ç›¸æœºé«˜åº¦</label>
            <input type="range" id="cameraHeight" min="0" max="25" step="0.5" value="5">
            <div class="value" id="cameraHeightValue">5</div>
        </div>
        <div class="control-group">
            <label>ç›¸æœºFOV</label>
            <input type="range" id="cameraFOV" min="10" max="60" step="1" value="49">
            <div class="value" id="cameraFOVValue">49Â°</div>
        </div>
        <div class="control-group">
            <label>æ˜Ÿçƒå±å¹•ä½ç½® X</label>
            <input type="range" id="planetScreenX" min="0" max="1" step="0.01" value="0.93">
            <div class="value" id="planetScreenXValue">0.93</div>
        </div>
        <div class="control-group">
            <label>æ˜Ÿçƒå±å¹•ä½ç½® Y</label>
            <input type="range" id="planetScreenY" min="0" max="1" step="0.01" value="0.39">
            <div class="value" id="planetScreenYValue">0.39</div>
        </div>
        <div class="control-group">
            <label>æ˜Ÿæ˜Ÿç¢ç‰‡æ•°é‡</label>
            <input type="range" id="starFragmentCount" min="50" max="500" step="10" value="200">
            <div class="value" id="starFragmentCountValue">200</div>
        </div>
        <div class="control-group">
            <label>æ˜Ÿæ˜Ÿç¢ç‰‡å¤§å°æ¯”ä¾‹</label>
            <input type="range" id="starFragmentSizeScale" min="1" max="3" step="0.1" value="1">
            <div class="value" id="starFragmentSizeScaleValue">1.0</div>
        </div>
        <div class="control-group">
            <label>å†…ç¯ç¢ç‰‡æ¯”ä¾‹</label>
            <input type="range" id="innerRingRatio" min="0" max="1" step="0.1" value="0.05">
            <div class="value" id="innerRingRatioValue"></div>
        </div>
        <div class="control-group">
            <label>ä¸­å†…ç¯ç¢ç‰‡æ¯”ä¾‹</label>
            <input type="range" id="middleRingRatio" min="0" max="1" step="0.1" value="0.3">
            <div class="value" id="middleRingRatioValue"></div>
        </div>
        <div class="control-group">
            <label>ä¸­å¤–ç¯ç¢ç‰‡æ¯”ä¾‹</label>
            <input type="range" id="outerRingRatio" min="0" max="1" step="0.1" value="0.55">
            <div class="value" id="outerRingRatioValue"></div>
        </div>
        <div class="control-group">
            <label>å¤–ç¯ç¢ç‰‡æ¯”ä¾‹</label>
            <input type="range" id="outerMostRingRatio" min="0" max="1" step="0.1" value="0.1">
            <div class="value" id="outerMostRingRatioValue"></div>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="rbStyleToggle" checked style="margin-right: 5px;">
                ä½¿ç”¨ RenderBundle é£æ ¼ç¢ç‰‡ç”Ÿæˆï¼ˆå¯ç”¨æ—¶å¼ºåˆ¶ WebGL ä¸åŠ¨æ€ï¼‰
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="ringVisibility" checked style="margin-right: 5px;">
                æ˜¾ç¤ºæ˜Ÿç¯ä¸»ä½“
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="photoThumbnails" style="margin-right: 5px;">
                æ˜¾ç¤ºç…§ç‰‡ç¼©ç•¥å›¾
            </label>
        </div>
        <div class="control-group">
            <label style="color: #4CAF50; font-size: 11px;">
                ğŸ“± é™€èºä»ªè§†å·®æ•ˆæœå·²å¯ç”¨<br>
                <span style="color: #888; font-size: 10px;">å€¾æ–œè®¾å¤‡æŸ¥çœ‹èƒŒæ™¯ç§»åŠ¨æ•ˆæœ</span>
            </label>
        </div>
        
        <!-- æµæ˜Ÿé›¨æ•ˆæœæ§åˆ¶ -->
        <div class="control-group">
            <label style="color: #ff6b6b; font-weight: bold;">â˜„ï¸ æµæ˜Ÿé›¨æ•ˆæœ</label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="meteorShowerToggle" style="margin-right: 5px;">
                å¯ç”¨æµæ˜Ÿé›¨èƒŒæ™¯
            </label>
        </div>
        <div class="control-group">
            <label>æµæ˜Ÿæ•°é‡</label>
            <input type="range" id="meteorCount" min="5" max="50" step="5" value="20">
            <div class="value" id="meteorCountValue">20</div>
        </div>
        <div class="control-group">
            <label>ç”Ÿæˆé¢‘ç‡</label>
            <input type="range" id="meteorSpawnRate" min="0.1" max="2" step="0.1" value="0.3">
            <div class="value" id="meteorSpawnRateValue">0.3</div>
        </div>
        <div class="control-group">
            <label>æµæ˜Ÿé€Ÿåº¦</label>
            <input type="range" id="meteorSpeed" min="0.1" max="2" step="0.1" value="0.5">
            <div class="value" id="meteorSpeedValue">0.5</div>
        </div>
        <div class="control-group">
            <label>æ‹–å°¾é•¿åº¦</label>
            <input type="range" id="meteorLength" min="0.1" max="2" step="0.1" value="0.8">
            <div class="value" id="meteorLengthValue">0.8</div>
        </div>
        
        <!-- åå¤„ç†æ•ˆæœæ§åˆ¶ -->
        <div class="control-group">
            <label style="color: #ff6b6b; font-weight: bold;">ğŸ¨ åå¤„ç†æ•ˆæœ</label>
        </div>
        <div class="control-group">
            <label>æ•ˆæœæ¨¡å¼</label>
            <select id="postProcessingMode" style="width: 100%; padding: 5px; background: rgba(255,255,255,0.1); border: 1px solid #fff; border-radius: 4px; color: #fff;">
                <option value="default">é»˜è®¤æ¨¡å¼</option>
                <option value="pixel">åƒç´ é£æ ¼</option>
                <option value="afterimage">æ‹–å°¾æ•ˆæœ</option>
                <option value="toon" selected>Tooné£æ ¼</option>
            </select>
        </div>
        <div class="control-group" id="pixelControls" style="display: none;">
            <label>åƒç´ å¤§å°</label>
            <input type="range" id="pixelSize" min="1" max="16" step="1" value="6">
            <div class="value" id="pixelSizeValue">6</div>
        </div>
        <div class="control-group" id="pixelControls2" style="display: none;">
            <label>æ³•çº¿è¾¹ç¼˜å¼ºåº¦</label>
            <input type="range" id="normalEdgeStrength" min="0" max="2" step="0.05" value="1.0">
            <div class="value" id="normalEdgeStrengthValue">1.0</div>
        </div>
        <div class="control-group" id="pixelControls3" style="display: none;">
            <label>æ·±åº¦è¾¹ç¼˜å¼ºåº¦</label>
            <input type="range" id="depthEdgeStrength" min="0" max="1" step="0.05" value="1.0">
            <div class="value" id="depthEdgeStrengthValue"></div>
        </div>
        
        <!-- æ‹–å°¾æ•ˆæœæ§åˆ¶ -->
        <div class="control-group" id="afterimageControls" style="display: none;">
            <label>æ‹–å°¾åœç•™æ—¶é—´</label>
            <input type="range" id="afterimageDamp" min="0.7" max="0.99" step="0.01" value="0.98">
            <div class="value" id="afterimageDampValue"></div>
        </div>
        <div class="control-group" id="afterimageControls2" style="display: none;">
            <label>æ‹–å°¾å¼ºåº¦</label>
            <input type="range" id="afterimageStrength" min="0.1" max="1.0" step="0.05" value="1.0">
            <div class="value" id="afterimageStrengthValue"></div>
        </div>
        <div class="control-group" id="afterimageControls3" style="display: none;">
            <label></label>
            <input type="range" id="trailSpeedMultiplier" min="1" max="20" step="1" value="10">
            <div class="value" id="trailSpeedMultiplierValue"></div>
        </div>
        <div class="control-group" id="afterimageControls4" style="display: none;">
            <button id="trailTestToggle" style="width: 100%; padding: 8px; background: rgba(255,107,107,0.2); border: 1px solid #ff6b6b; border-radius: 4px; color: #ff6b6b; cursor: pointer;">
                æ‹–å°¾æµ‹è¯•æ¨¡å¼ (åŠ é€Ÿæ—‹è½¬)
            </button>
        </div>
        
        <!-- Tooné£æ ¼æ§åˆ¶ -->
        <div class="control-group" id="toonControls" style="display: none;">
            <button id="toonModeToggle" style="width: 100%; padding: 8px; background: rgba(255,193,7,0.2); border: 1px solid #ffc107; border-radius: 4px; color: #ffc107; cursor: pointer;">
                Tooné£æ ¼åŒ–æ¸²æŸ“
            </button>
        </div>
        <div class="control-group" id="toonControls2" style="display: none;">
            <label>Toonçƒä½“æ•°é‡</label>
            <input type="range" id="toonSphereCount" min="1" max="10" step="1" value="3">
            <div class="value" id="toonSphereCountValue"></div>
        </div>
        <div class="control-group" id="toonControls3" style="display: none;">
            <label>é¢œè‰²é¥±å’Œåº¦</label>
            <input type="range" id="toonSaturation" min="0.1" max="1.0" step="0.1" value="0.7">
            <div class="value" id="toonSaturationValue"></div>
        </div>
        <div class="control-group" id="toonControls4" style="display: none;">
            <label>å®šå‘å…‰å€ç‡</label>
            <input type="range" id="directionalLightMultiplier" min="1" max="200" step="1" value="3">
            <div class="value" id="directionalLightMultiplierValue"></div>
        </div>
        <div class="control-group" id="toonControls5" style="display: none;">
            <label>åŠçƒå…‰å€ç‡</label>
            <input type="range" id="hemisphereLightMultiplier" min="1" max="200" step="1" value="50">
            <div class="value" id="hemisphereLightMultiplierValue"></div>
        </div>
        <div class="control-group" id="toonControls6" style="display: none;">
            <label>ç¯å¢ƒå…‰å€ç‡</label>
            <input type="range" id="ambientLightMultiplier" min="1" max="200" step="1" value="80">
            <div class="value" id="ambientLightMultiplierValue"></div>
        </div>
        
        <!-- æ·»åŠ åº•éƒ¨è¾¹è·ï¼Œç¡®ä¿æ»šåŠ¨åŒºåŸŸè¶³å¤Ÿ -->
        <div style="height: 200px; margin-bottom: 100px; margin-top: 100px;"></div>
        </div>
    </div>

    <div class="instructions">
        ç‚¹å‡»/è§¦æ‘¸æ˜Ÿæ˜Ÿç¢ç‰‡æŸ¥çœ‹å›å¿†ç…§ç‰‡ â€¢ ç‚¹å‡»/è§¦æ‘¸ä»»æ„åœ°æ–¹å…³é—­ç…§ç‰‡ â€¢ æŒ‰ 'C' é”®åˆ‡æ¢æ§åˆ¶é¢æ¿ â€¢ å€¾æ–œè®¾å¤‡ä½“éªŒé™€èºä»ªç›¸æœºæ—‹è½¬æ•ˆæœï¼ˆæœ€å¤š3Â°ï¼‰
    </div>

    <!-- ä½¿ç”¨æ¨¡å—ç‰ˆæœ¬Three.jsï¼Œé¿å…é‡å¤å¯¼å…¥ -->
    <script type="importmap">
        {
            "imports": {
                "three": "./three.js/build/three.module.js",
                "three/addons/": "./three.js/examples/jsm/"
            }
        }
    </script>
    
    <script type="module" src="src/main.js"></script>
</body>
</html>
